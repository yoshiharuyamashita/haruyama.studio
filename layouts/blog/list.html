{{ define "main" }}

{{ partial "page-title.html" . }}

<section class="section pt-0">
  <div class="container">
    <div class="row">
      <div class="card-deck">
        {{ $paginator := .Paginate .Data.Pages }}
        {{ range $paginator.Pages }}
        <div class="col-sm-6 col-lg-4 mx-auto mb-5">
          <article class="card h-100">
            {{ $title := .Title }}

            {{ $scratch := newScratch }}

            {{ with .Resources.GetMatch .Params.image }}

            {{/* set image sizes, these are hardcoded for now, x dictates that images are resized to this width */}}
            {{ $tinyw := default "500x" }}
            {{ $smallw := default "800x" }}
            {{ $mediumw := default "1200x" }}
            {{ $largew := default "1500x" }}

            {{/* resize the src image to the given sizes */}}
            {{ $scratch.Set "tiny" (.Resize $tinyw) }}
            {{ $scratch.Set "small" (.Resize $smallw) }}
            {{ $scratch.Set "medium" (.Resize $mediumw) }}
            {{ $scratch.Set "large" (.Resize $largew) }}

            {{/* add the processed images to the scratch */}}
            {{ $tiny := $scratch.Get "tiny" }}
            {{ $small := $scratch.Get "small" }}
            {{ $medium := $scratch.Get "medium" }}
            {{ $large := $scratch.Get "large" }}

            {{/* only use images smaller than or equal to the src (original) image size, as Hugo will upscale small images */}}
            {{/* set the sizes attribute to (min-width: 35em) 1200px, 100vw */}}

            <img class="card-img-top"
            sizes="(min-width: 35em) 1200px, 100vw"
            srcset='
            {{ if ge .Width "500" }}
              {{ with $tiny.RelPermalink }}{{.}} 500w{{ end }}
            {{ end }}
            {{ if ge .Width "800" }}
              {{ with $small.RelPermalink }}, {{.}} 800w{{ end }}
            {{ end }}
            {{ if ge .Width "1200" }}
              {{ with $medium.RelPermalink }}, {{.}} 1200w{{ end }}
            {{ end }}
            {{ if ge .Width "1500" }}
              {{ with $large.RelPermalink }}, {{.}} 1500w {{ end }}
            {{ end }}'
            {{ if ge (print $medium) }}
              src="{{ $medium.RelPermalink }}" 
            {{ else }}
              src="{{ .RelPermalink }}" 
            {{ end }}
            alt="{{ $title | markdownify }}">
            {{ end }}
            <div class="card-body">
              {{ partial "article-meta.html" . }}
              <a href="{{ .Permalink }}" class="h4 d-block">{{ .Title | markdownify }}</a>
              <p class="card-text">{{ .Summary }}</p>
            </div>
            <a href="{{ .Permalink }}" class="card-footer btn btn-primary">View Post</a>
          </article>
        </div>
        {{ end }}
      </div>
    </div>
    {{ template "_internal/pagination.html" . }}
  </div>
</section>

{{ if site.Data.homepage.cta.enable }}
{{ partial "cta.html" . }}
{{ end }}

{{ end }}