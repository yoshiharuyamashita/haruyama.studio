{{ define "main" }}

<section>

  <h1 class="page-title">{{ .Title }}</h1>

  {{ $raw := replace .RawContent "\r\n" "\n" }}
  {{ $segments := split $raw "<!-- image -->" }}
  {{ $before := trim (index $segments 0) " \r\n\t" }}
  {{ $after := "" }}
  {{ if gt (len $segments) 1 }}
    {{ $after = trim (delimit (after 1 $segments) "<!-- image -->") " \r\n\t" }}
  {{ end }}

  {{ if gt (len $segments) 1 }}
    <div class="copy">
      {{ $before | markdownify }}
    </div>

    {{ partial "media/gallery.html" . }}

    <div class="copy">
      {{ $after | markdownify }}
    </div>
  {{ else }}
    {{ partial "media/gallery.html" . }}

    <div class="copy">
      {{ .Content }}
    </div>
  {{ end }}

  {{ with .Params.shop_url }}
    <a
      class="button"
      href="{{ . }}"
      target="_blank"
      rel="noopener">
      {{ $.Params.shop_label }}
    </a>
  {{ end }}

</section>

{{ end }}